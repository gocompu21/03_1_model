{% if recent_attempts %}
<style>
    .history-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .history-table th {
        background-color: #2d6a4f;
        color: white;
        padding: 12px 15px;
        font-weight: 600;
        text-align: center;
        font-size: 0.95rem;
    }

    .history-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #e9ecef;
        color: #333;
        vertical-align: middle;
        text-align: center;
        font-size: 0.95rem;
    }

    .history-table tr:hover {
        background-color: #f8f9fa;
    }

    .score-badge {
        font-weight: bold;
        color: #2d6a4f;
        background-color: #d8f3dc;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85rem;
        display: inline-block;
        min-width: 60px;
    }

    .btn-icon {
        border: none;
        background: none;
        cursor: pointer;
        padding: 5px;
        font-size: 1.1rem;
        transition: transform 0.2s;
    }

    .btn-icon:hover {
        transform: scale(1.1);
    }

    .btn-note {
        color: #2d6a4f;
    }

    .btn-del {
        color: #fa5252;
    }
</style>

<div style="text-align: right; margin-bottom: 10px; font-size: 0.85rem; color: #666;">
    <span style="margin-right: 15px;">
        <i class="fas fa-book-open" style="color: #2d6a4f;"></i> 오답노트
    </span>
    <span>
        <i class="fas fa-trash-alt" style="color: #fa5252;"></i> 삭제
    </span>
</div>
<div style="overflow-x: auto;">
    <table class="history-table">
        <thead>
            <tr>
                <th style="width: 15%;">시험 회차</th>
                <th style="width: 20%;">응시 일시</th>
                <th style="width: 15%;">점수</th>
                <th style="width: 30%;">정답률</th>
                <th style="width: 20%;">관리</th>
            </tr>
        </thead>
        <tbody>
            {% for attempt in recent_attempts %}
            <tr>
                <td>
                    <span style="font-weight: bold; color: #2d6a4f;">{% if attempt.exam.round_number == 0 %}모의고사
                        {% else%}제{{ attempt.exam.round_number }}회{% endif %}</span>
                </td>
                <td style="color: #666;">
                    {{ attempt.start_time|date:"Y.m.d" }}
                </td>
                <td>
                    <span class="score-badge">{% widthratio attempt.correct_q attempt.total_q 100 %}점</span>
                </td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div
                            style="flex-grow: 1; background-color: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div
                                style="background-color: #2d6a4f; height: 100%; width: {% widthratio attempt.correct_q attempt.total_q 100 %}%;">
                            </div>
                        </div>
                        <span style="font-size: 0.8rem; color: #666; width: 60px; text-align: right;">
                            {{ attempt.correct_q }}/{{ attempt.total_q }}
                        </span>
                    </div>
                </td>
                <td>
                    <div style="display: flex; justify-content: center; gap: 0;">
                        <div style="width: 40px; text-align: center;">
                            {% if attempt.total_q > attempt.correct_q %}
                            <button onclick="loadWrongAnswersByAttempt({{ attempt.id }})" class="btn-icon btn-note"
                                title="오답노트 보기">
                                <i class="fas fa-book-open"></i>
                            </button>
                            {% else %}
                            <span style="color: #2d6a4f; font-size: 1.2rem;" title="만점"><i
                                    class="fas fa-medal"></i></span>
                            {% endif %}
                        </div>
                        <div style="width: 40px; text-align: center;">
                            <button onclick="deleteAttempt({{ attempt.id }})" class="btn-icon btn-del" title="기록 삭제">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination Controls -->
<div class="pagination" style="margin-top: 30px; text-align: center;">
    {% if recent_attempts.has_previous %}
    <a href="?page=1&tab=history" class="ajax-link" data-page="1" style="margin: 0 5px; color: #2d6a4f;">&laquo; 처음</a>
    <a href="?page={{ recent_attempts.previous_page_number }}&tab=history" class="ajax-link"
        data-page="{{ recent_attempts.previous_page_number }}" style="margin: 0 5px; color: #2d6a4f;">이전</a>
    {% endif%}

    {% for num in recent_attempts.paginator.page_range %}
    {% if num == recent_attempts.number %}
    <span class="active" style="margin: 0 5px; font-weight: bold; color: #2d6a4f; text-decoration: underline;">
        {{ num}}</span>
    {% elif num > recent_attempts.number|add:'-3' and num < recent_attempts.number|add:'3' %} <a
        href="?page={{ num }}&tab=history" class="ajax-link" data-page="{{ num }}"
        style="margin: 0 5px; color: #495057; text-decoration: none;">{{ num }}</a>
        {% endif %}
        {% endfor %}

        {% if recent_attempts.has_next %}
        <a href="?page={{ recent_attempts.next_page_number }}&tab=history" class="ajax-link"
            data-page="{{ recent_attempts.next_page_number }}" style="margin: 0 5px; color: #2d6a4f;">다음</a>
        <a href="?page={{ recent_attempts.paginator.num_pages }}&tab=history" class="ajax-link"
            data-page="{{ recent_attempts.paginator.num_pages }}" style="margin: 0 5px; color: #2d6a4f;">마지막 &raquo;</a>
        {% endif %}
</div>

{% else %}
<div
    style="text-align: center; padding: 60px 20px; color: #888; background: #f8f9fa; border-radius: 12px; margin-top: 20px;">
    <i class="fas fa-seedling" style="font-size: 3rem; color: #dee2e6; margin-bottom: 20px;"></i>
    <p style="font-size: 1.1rem; margin-bottom: 20px;">아직 응시한 기출시험 기록이 없습니다.<br>나무의사 합격을 위한 첫 걸음을 시작해보세요!</p>
    <a href="{% url 'exam:index' %}" class="btn"
        style="background-color: #2d6a4f; color: white; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; transition: opacity 0.2s;">
        <i class="fas fa-play"></i> 시험 보러 가기
    </a>
</div>
{% endif %}